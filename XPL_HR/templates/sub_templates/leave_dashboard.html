<div class="containe-fluid mt-5" style="margin-top:-70px !important">
    <!-- Dashboard Cards -->
     
    <div class="row text-center mb-4">
        <div class="col-md-4">
            <div class="dashboard-card card-total-employees">
                <div class="icon-container">
                    <i class="fas fa-users"></i> <!-- employee icon -->
                </div>
                <div class="dashboard-text">
                    <h5>Total Employees</h5>
                    <h3>{{ total_employees }}</h3> 
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="dashboard-card card-total-departments">
                <div class="icon-container">
                    <i class="fas fa-building"></i> <!-- Department Icon -->
                </div>
                <div class="dashboard-text">
                    <h5>Total Departments</h5>
                    <!-- <h3>{{total_departments}}</h3>  -->
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="dashboard-card card-total-supervisors">
                <div class="icon-container">
                    <i class="fas fa-user-tie"></i> <!-- Supervisors Icon -->
                </div>
                <div class="dashboard-text">
                    <h5>Total Supervisors</h5>
                    <h3>{{total_supervisors}}</h3> 
                </div>
            </div>
        </div>
    </div>
    {% if messages %}
    <div class="alert alert-info">
        {% for message in messages %}
            <p>{{ message }}</p>
        {% endfor %}
    </div>
{% endif %}

    {% if request.session.role == 'admin' %}
<h3 class="text-center">Leave Requests</h3>
<br>
    <!-- Scrollable Table -->
    <div class="table-container">
        
        <table class="table table-hover" id="employeeTable">
            <thead class="table-primary">
                <tr>
                    <th scope="col">Applicant Name</th>
                    <th scope="col">Leave Type</th>
                    <th scope="col">Leave Start</th>
                    <th scope="col">Leave End</th>
                    <th scope="col">Reason</th>
                    <th scope="col">Status</th>
                    <th scope="col">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for leaves in leave_applications %}
                <tr>
                    <td>{{ leaves.employee.first_name }} {{ leaves.employee.last_name }}</td>
                    <td>{{ leaves.leave_type }}</td>
                    <td>{{ leaves.start_date }}</td>
                    <td>{{ leaves.end_date }}</td>
                    <td>{{ leaves.reason }}</td>
                    <td>{{ leaves.status }}</td>
                    <td>
                        {% if leaves.status == 'Pending' %}
                            <button type="button" class="btn btn-success btn-sm" 
                                    onclick="openModal('{{ leaves.id }}', 'approved')">
                                <i class="fa fa-check"></i>
                            </button>
                            <button type="button" class="btn btn-danger btn-sm" 
                                    onclick="openModal('{{ leaves.id }}', 'rejected')">
                                <i class="fas fa-trash"></i>
                            </button>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                    <tr>
                        <td colspan="7" class="text-center">No Leaves Requested.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <!-- remarks popup modal -->
        <div id="remarksModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2>Leave Remarks</h2>
                <form method="POST" id="remarksForm" action="{% url 'leave' %}">
                    {% csrf_token %}
                    <input type="hidden" name="leave_application_id" id="leaveApplicationId">
                    <input type="hidden" name="status" id="leaveStatus">
                    <textarea name="remarks" required placeholder="Enter remarks here..."></textarea>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>

    <br>
    {% endif %}
    <h3 class="text-center">Your Leave Applications</h2>
<table class="table">
    <thead class="table-primary">
        <tr>
            <th scope="col">Leave Type</th>
            <th scope="col">Leave Days</th>
            <th scope="col">Status</th>
            <th scope="col">Remarks</th>
        </tr>
    </thead>
    <tbody>
        {% for leaves in logged_in_user %}
        <tr>
            <td>{{ leaves.leave_type }}</td>
            <td>{{ leaves.leave_days }}</td>
            <td>{{ leaves.status }}</td>
            <td class="remarks">{{leaves.remarks}}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="3" class="text-center">No leave applications found.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

</div>
<style>
    td.remarks {
    max-width: 200px; 
    word-wrap: break-word; 
    white-space: normal; 
}
    .modal {
    display: none;
    position: fixed; 
    z-index: 1; 
    left: 0;
    top: 0;
    width: 100%; 
    height: 100%; 
    overflow: auto; 
    background-color: rgb(0,0,0); 
    background-color: rgba(0,0,0,0.4); 
}

/* Modal Content */
.modal-content {
    background-color: #fefefe;
    margin: 15% auto; 
    padding: 20px;
    border: 1px solid #888;
    width: 80%; 
    border-radius: 5px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

/* Close Button */
.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}


textarea {
    width: 100%;
    height: 100px;
    padding: 10px;
    margin-top: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    resize: none; 
}
</style>
<script>
    function openModal(leaveId, status) {
        document.getElementById('leaveApplicationId').value = leaveId;
        document.getElementById('leaveStatus').value = status;
        document.getElementById('remarksModal').style.display = 'block'; 
    }

    function closeModal() {
        document.getElementById('remarksModal').style.display = 'none'; 
    }
</script>