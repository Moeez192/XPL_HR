<div class="containe-fluid mt-5">
    <div class="scrollable-container">
        <h3 class="text-center">Add TimeSheet</h3>

        <form method="POST" action="{% url 'timesheet' %}">
            {% csrf_token %}

            <div class="row">
                <div class="col-6">
                    <div class="project-info">
                        <div>
                            <label><strong>Select Project Name:</strong></label>
                            <select name="project_id" class="form-control">
                                {% for project in projects %}
                                    <option value="{{ project.id }}">{{ project.project_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label><strong>Employee/Consultant Name:</strong></label>
                            <input type="text" class="form-control" value="{{ request.user.first_name }} {{ request.user.last_name }}" readonly>
                        </div>
                        <div class="mt-3">
                            <label><strong>Date Range:</strong></label>
                            <div class="d-flex">
                                <input type="date" id="date_from" name="date_from" class="form-control me-2" required>
                                <input type="date" id="date_to" name="date_to" class="form-control" required>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <table class="table table-bordered mt-4">
                <thead>
                    <tr class="table-header">
                        <th>Date</th>
                        <th>Task Description</th>
                        <th>Location</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody id="timesheet-entries">
                    <!-- dynamic fields according to the selected date range -->
                </tbody>
            </table>

            <div class="d-flex justify-content-end mt-4">
                <!-- <button type="submit" name="action" value="submit" class="btn btn-success me-2">Submit</button>
                <button type="submit" name="action" value="save" class="btn btn-primary">Save</button> -->
                
                <button type="submit" name="action" value="save" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.getElementById("date_to").addEventListener("change", generateFields);
    
    function generateFields() {
        const startDate = new Date(document.getElementById("date_from").value);
        const endDate = new Date(document.getElementById("date_to").value);
        const timesheetContainer = document.getElementById("timesheet-entries");
        timesheetContainer.innerHTML = ""; // Clear previous fields
    
        let currentDate = new Date(startDate);
        while (currentDate <= endDate) {
            const dayOfWeek = currentDate.getDay(); // 0 for Sunday, 6 for Saturday
            const dateStr = currentDate.toISOString().split("T")[0];
    
            // Create table row
            const row = document.createElement("tr");
            if (dayOfWeek === 0 || dayOfWeek === 6) {
                row.classList.add("weekend"); // Highlight weekends
            }
    
            // Date Cell
            const dateCell = document.createElement("td");
            dateCell.textContent = dateStr;
            row.appendChild(dateCell);
    
            // Task Description Cell
            const taskCell = document.createElement("td");
            const taskInput = document.createElement("textarea");
            taskInput.name = `task_description_${dateStr}`;
            taskInput.className = "form-control";  // Form control styling
            taskInput.placeholder = "Task description";
            taskInput.required = true;
            if (dayOfWeek === 0 || dayOfWeek === 6) taskInput.disabled = true;
            taskCell.appendChild(taskInput);
            row.appendChild(taskCell);
    
            // Location Cell
            const locationCell = document.createElement("td");
            const locationSelect = document.createElement("select");
            locationSelect.name = `location_${dateStr}`;
            locationSelect.className = "form-control";  // Form control styling
            locationSelect.required = true;
            ["onsite", "offsite", "remote"].forEach(loc => {
                const option = document.createElement("option");
                option.value = loc;
                option.textContent = loc.charAt(0).toUpperCase() + loc.slice(1);
                locationSelect.appendChild(option);
            });
            if (dayOfWeek === 0 || dayOfWeek === 6) locationSelect.disabled = true;
            locationCell.appendChild(locationSelect);
            row.appendChild(locationCell);
    
            // Notes Cell
            const notesCell = document.createElement("td");
            const notesInput = document.createElement("textarea");
            notesInput.name = `notes_${dateStr}`;
            notesInput.className = "form-control";  // Form control styling
            notesInput.placeholder = "Notes";
            if (dayOfWeek === 0 || dayOfWeek === 6) notesInput.disabled = true;
            notesCell.appendChild(notesInput);
            row.appendChild(notesCell);
    
            // Append row to main container
            timesheetContainer.appendChild(row);
    
            // Move to the next day
            currentDate.setDate(currentDate.getDate() + 1);
        }
    }
</script>
    
<style>
    .timesheet-entry {
        margin: 1rem 0;
        padding: 1rem;
        border: 1px solid #ddd;
        border-radius: 5px;
    }
    
    .weekend {
        background-color: #f8d7da; /* Light red background for weekends */
        color: #721c24; /* Dark red text */
    }
    
    /* .table-header th {
        background-color: #f1f1f1;
        text-align: center;
    } */
</style>
